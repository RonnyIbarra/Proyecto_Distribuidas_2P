openapi: 3.0.3
info:
  title: Servicio de Autenticación - LogiFlow
  description: API REST para autenticación y gestión de tokens JWT
  version: 1.0.0
servers:
  - url: http://localhost:8081/api/auth
    description: Servidor de desarrollo

paths:
  /login:
    post:
      summary: Iniciar sesión
      description: Autentica un usuario y devuelve tokens JWT (acceso y recuperación)
      tags:
        - Autenticación
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - correo
                - contrasena
              properties:
                correo:
                  type: string
                  format: email
                  example: usuario@example.com
                contrasena:
                  type: string
                  minLength: 6
                  example: MiPassword123
      responses:
        '200':
          description: Autenticación exitosa
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RespuestaTokenAutenticacion'
        '400':
          description: Credenciales inválidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: No autorizado

  /register:
    post:
      summary: Registrar nuevo usuario
      description: Crea una nueva cuenta de usuario en el sistema
      tags:
        - Autenticación
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - correo
                - contrasena
                - nombreCompleto
                - rol
              properties:
                correo:
                  type: string
                  format: email
                  example: nuevo@example.com
                contrasena:
                  type: string
                  minLength: 6
                  example: NuevaPassword456
                nombreCompleto:
                  type: string
                  example: Juan Pérez García
                telefonoContacto:
                  type: string
                  example: "+593 9 87654321"
                rol:
                  type: string
                  enum: [CLIENTE, REPARTIDOR, SUPERVISOR, GERENTE, ADMIN]
                  example: CLIENTE
      responses:
        '201':
          description: Usuario registrado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RespuestaTokenAutenticacion'
        '400':
          description: Datos inválidos o usuario ya existe
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /token/refresh:
    post:
      summary: Renovar token de acceso
      description: Utiliza el token de recuperación para obtener un nuevo token de acceso
      tags:
        - Autenticación
      parameters:
        - name: tokenRecuperacion
          in: query
          required: true
          schema:
            type: string
          example: eyJhbGciOiJIUzI1NiJ9...
      responses:
        '200':
          description: Token renovado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RespuestaTokenAutenticacion'
        '401':
          description: Token inválido o expirado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /validate:
    get:
      summary: Validar token JWT
      description: Verifica si un token JWT es válido y no está expirado
      tags:
        - Autenticación
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          example: eyJhbGciOiJIUzI1NiJ9...
      responses:
        '200':
          description: Token válido
          content:
            application/json:
              schema:
                type: boolean
                example: true
        '401':
          description: Token inválido o expirado
          content:
            application/json:
              schema:
                type: boolean
                example: false

components:
  schemas:
    RespuestaTokenAutenticacion:
      type: object
      properties:
        tokenAcceso:
          type: string
          description: Token JWT para acceso a endpoints protegidos
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwicm9sIjoiQ0xJRU5URSIsImlhdCI6MTcwMjc3ODAwMH0...
        tokenRecuperacion:
          type: string
          description: Token para renovar el token de acceso
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiaWF0IjoxNzAyNzc4MDAwfQ...
        expiraEn:
          type: integer
          format: int64
          description: Tiempo de expiración en milisegundos
          example: 86400000
        tipoToken:
          type: string
          example: Bearer
        usuario:
          $ref: '#/components/schemas/RespuestaUsuario'

    RespuestaUsuario:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        correo:
          type: string
          format: email
          example: usuario@example.com
        nombreCompleto:
          type: string
          example: Juan Pérez García
        telefonoContacto:
          type: string
          example: "+593 9 87654321"
        rol:
          type: string
          enum: [CLIENTE, REPARTIDOR, SUPERVISOR, GERENTE, ADMIN]
          example: CLIENTE
        activo:
          type: boolean
          example: true
        fechaCreacion:
          type: string
          format: date-time
          example: "2025-12-16T18:08:22"
        fechaActualizacion:
          type: string
          format: date-time
          example: "2025-12-16T18:08:22"

    Error:
      type: object
      properties:
        codigo:
          type: string
          example: "AUTH_001"
        mensaje:
          type: string
          example: "Credenciales inválidas"
        timestamp:
          type: string
          format: date-time
